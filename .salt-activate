#!/bin/bash -e
# vim: set ts=4 sw=4 sts=4 et :

# To activate minion in AppVM run this script in AppVM after it has
# been installed in templateVM
#
# TemplateVM automatically accepts minion when installed

SRC_PATH="$(readlink -m $0)"
SRC_DIR="${SRC_PATH%/*}"

source "${SRC_DIR}/.salt-functions.sh"

# Instead of auto-accepting minions; just do it here
function saltActivate() {
    salt-key -y -A
    sync
    systemctl restart salt-master salt-minion || true
}

# Run saltActivate if called directly
if [ "${SRC_PATH##*/}" == ".salt-activate" ]; then
    saltActivate
fi
